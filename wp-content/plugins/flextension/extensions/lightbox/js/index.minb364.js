(()=>{"use strict";const{flextension:t,HTMLElement:e,requestAnimationFrame:o}=window,n=[];function i(t,e){if(this.options=Object.assign({className:"",open:!0,fullscreen:!0,closeButton:!0,onBeforeOpen:()=>{},onOpen:()=>{},onBeforeClose:()=>{},onClose:()=>{},onInit:()=>{}},e),this.isLoaded=!1,this.content=this.parseContent(t),null!==this.content)return this.element=document.createElement("div"),this.element.setAttribute("role","dialog"),this.addClass("flext-lightbox"),this.options.className&&("string"==typeof this.options.className?this.options.className.split(" "):this.options.className).forEach((t=>{this.addClass(t)})),this.options.fullscreen&&this.addClass("flext-lightbox-fullscreen"),document.body.appendChild(this.element),this.container=document.createElement("div"),this.container.classList.add("flext-lightbox-container"),this.element.appendChild(this.container),this.element.addEventListener("click",(t=>{t.target!==this.element&&t.target!==this.container&&t.target!==this.content||this.close()})),this.element&&this.element.ownerDocument.contains(this.content)&&(this.placeholder=document.createElement("div"),this.placeholder.classList.add("flext-lightbox-placeholder"),this.content.parentElement.insertBefore(this.placeholder,this.content)),this.container.appendChild(this.content),!0===s(this.container,"IMG")&&this.addClass("flext-lightbox-img"),!0===s(this.container,"VIDEO")&&this.addClass("flext-lightbox-video"),!0===s(this.container,"AUDIO")&&this.addClass("flext-lightbox-audio"),!0===s(this.container,"IFRAME")&&this.addClass("flext-lightbox-iframe"),!1!==this.options.closeButton&&(this.closeButton=document.createElement("button"),this.closeButton.classList.add("flext-lightbox-close","flext-ico-cancel"),this.container.appendChild(this.closeButton),this.closeButton.addEventListener("click",(()=>{this.close()}))),"function"==typeof this.options.onInit&&this.options.onInit(this),!0===this.options.open&&setTimeout((()=>{this.open()}),100),this}function s(t,e){const o=t.children;return o.length>0&&o[0].tagName===e}i.prototype.parseContent=function(t){const o="string"==typeof t;if(!1===o&&!1==(t instanceof e==1))throw new Error("Content must be a DOM element/node or string");if(this.isLoaded=!0,o){if(t&&t.startsWith("#")){let e=document.querySelector(t);if(null===e){e=document.createElement("div"),e.setAttribute("id",t.replace("#","")),e.classList.add("flext-lightbox-content-placeholder");let o=document.getElementById("site-content");null===o&&(o=document.body),o.append(e),this.isLoaded=!1}return e}return function(t){const e=document.createElement("div");return e.innerHTML=t.trim(),e}(t)}return t},i.prototype.beforeOpen=function(){return"function"!=typeof this.options.onBeforeOpen||this.options.onBeforeOpen(this)},i.prototype.open=function(){!1!==this.beforeOpen()&&(this.content.classList.add("flext-lightbox-content"),!0!==l&&(document.addEventListener("keydown",h),l=!0),o((()=>{this.addClass("flext-lightbox-visible"),"function"==typeof this.options.onOpen&&this.options.onOpen(this),t.emit("lightbox.open",this)})),n.push(this))},i.prototype.beforeClose=function(){return"function"!=typeof this.options.onBeforeClose||this.options.onBeforeClose(this)},i.prototype.close=function(){if(!1!==this.beforeClose())return new Promise((e=>{this.removeClass("flext-lightbox-visible"),setTimeout((()=>{this.content?.classList.remove("flext-lightbox-content"),!1===this.visible()&&"function"==typeof this.options.onClose&&this.options.onClose(this),this.placeholder&&(this.content&&this.isLoaded&&this.placeholder.parentElement.insertBefore(this.content,this.placeholder),this.placeholder.remove()),this.element?.parentElement.removeChild(this.element),"function"==typeof this.options.onClose&&this.options.onClose(this),n.forEach(((t,e)=>{t===this&&n.splice(e,1)})),t.emit("lightbox.close",this),!0===l&&0===n.length&&(document.removeEventListener("keydown",h),l=!1),function(t){const e=t;Object.keys(e).forEach((t=>{try{e[t]=null}catch(t){}try{delete e[t]}catch(t){}}))}(this),e()}),500)}))},i.prototype.visible=function(){return this.element&&this.element?.ownerDocument?.body.contains(this.element)},i.prototype.load=function({url:e,endpoint:o,data:n,callback:i}){if(this.isLoaded)return void this.loaded();this.loading();const s=document.createElement("span");if(s.classList.add("flext-loader"),this.content.append(s),o){if(!t.api)return;t.api.get(o,n).then((t=>{s.remove(),this.content&&("function"==typeof i&&i(t,this),this.loaded())}))}else t.ajax({url:e,data:n,callback:t=>{s.remove(),this.content&&("function"==typeof i&&i(t,this),this.loaded())}})},i.prototype.loading=function(){this.removeClass("flext-lightbox-loaded"),this.addClass("flext-lightbox-loading")},i.prototype.loaded=function(){this.isLoaded=!0,this.removeClass("flext-lightbox-loading"),this.addClass("flext-lightbox-loaded")},i.prototype.addClass=function(t){this.element?.classList.add(t)},i.prototype.removeClass=function(t){this.element?.classList.remove(t)};let l=!1;function h(e){"Escape"===e.key&&t.lightbox&&t.lightbox.close()}t.lightbox=i,t.lightbox.close=function(){Array.isArray(n)&&n.length>0&&n[n.length-1].close()},t.lightbox.closeAll=function(){Array.isArray(n)&&n.length>0&&n.forEach((t=>{t.close()}))}})();