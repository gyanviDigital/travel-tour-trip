(()=>{"use strict";const{flextension:t,IntersectionObserver:e}=window;function o(e,o){new t.lightbox(`#flext-author-${o}-list-${e}`,{className:"flext-author-follow-modal",fullscreen:!1}).load({endpoint:"/flextension/v1/"+o,data:{id:e},callback:(e,o)=>{o.content.innerHTML=e.rendered,n(o.content),t.emit("ready",o.content)}})}function l(e,o,l,n){t.api.get("/flextension/v1/"+e,{id:o,page:l}).then((t=>{"function"==typeof n&&n(t,this)}))}function n(o){o.querySelectorAll(".pagination a:not(.is-followers-pagination)").forEach((o=>{if(o.classList.contains("is-followers-pagination"))return;o.classList.add("is-followers-pagination");const s=o.dataset.page;if(s<2)return;const a=o.closest(".flext-author-follow-list");if(null===a)return;const i=a.parentElement.classList.contains("flext-author-followers-list")?"followers":"following",r=a.dataset.userId;let c=!1;const f=e=>{if(c=!1,o.parentElement.remove(),e.rendered){const o=document.createElement("div");o.innerHTML=e.rendered,a.append(o),n(o),t.emit("afterFollowersLoaded",o),t.emit("ready",o)}};o.addEventListener("click",(t=>{t.preventDefault(),!0!==c&&(c=!0,o.classList.add("flext-is-loading"),l(i,r,s,f))})),new e((t=>{t.forEach((t=>{t.intersectionRatio>0&&!0!==c&&(c=!0,o.classList.add("flext-is-loading"),l(i,r,s,f))}))})).observe(o)}))}t.on("ready",((e,l)=>{l||(l=document),function(e){e.querySelectorAll(".flext-author-follow").forEach((o=>{o.addEventListener("click",(l=>{l.preventDefault();const n=o.dataset.authorId;if(!n)return;const s=e.querySelectorAll('.flext-author-follow[data-author-id="'+n+'"]');s.forEach((t=>{t.classList.add("flext-is-loading")})),t.ajax({method:"POST",data:{action:"flextension_author_follow",author:n},callback:e=>{if(s.forEach((t=>{t.classList.remove("flext-is-loading")})),e){const l=parseInt(e.status,10);if(200===l){s.forEach((t=>{1===parseInt(e.button.status,10)?(t.classList.remove("flext-follow-button"),t.classList.add("flext-unfollow-button")):(t.classList.remove("flext-unfollow-button"),t.classList.add("flext-follow-button")),t.setAttribute("title",e.button.title)}));const t=o.querySelector("span");null!==t&&(t.innerHTML=e.message)}else 401===l&&(t.showLoginForm?t.showLoginForm():new t.lightbox("<p>"+e.message+"</p>",{className:"flext-author-follow-modal",fullscreen:!1}))}}})}))}))}(l),function(t){t.querySelectorAll(".flext-author-follow-numbers a").forEach((t=>{t.addEventListener("click",(e=>{if(e.preventDefault(),t.classList.contains("is-empty"))return;const l=t.dataset.authorId;l&&o(l,t.classList.contains("flext-author-followers")?"followers":"following")}))}))}(l)}))})();